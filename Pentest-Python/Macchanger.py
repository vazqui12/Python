import argparse
import subprocess
import signal
import sys
import re
import pyfiglet
from termcolor import colored

ascii_banner = pyfiglet.figlet_format("MAC CHANGER")
print(colored(ascii_banner,'yellow'))

def def_handler(sig, frame):
    print(colored(f"\n[!] Saliendo del programa...",'red'))
    sys.exit(1)

signal.signal(signal.SIGINT, def_handler) #ctrl + c

def get_arguments():
    parser = argparse.ArgumentParser(description='Herramienta para cambiar la dirección MAC de una interfaz de red')
    parser.add_argument("-i", "--interface", dest="interface", required=True, help="Nombre de la interfaz de red")
    parser.add_argument("-m", "--mac", dest="mac_address", required=True, help="Nueva dirección MAC para la interfaz de red")

    return  parser.parse_args()

def is_valid_input(interface, mac_address):

    is_valid_interface = re.match(r'^[e][n|t][s|h]\d{1,2}$', interface)
    is_valid_mac_address = re.match(r'^([A-Fa-f0-9]{2}[:]){5}[A-Fa-f0-9]{2}$', mac_address)


    return is_valid_interface and is_valid_mac_address


def change_mac_address(interface, mac_address):

    if is_valid_input(interface, mac_address):
        subprocess.run(["ifconfig", interface, "down"])
        subprocess.run(["ifconfig", interface, "hw", "ether", mac_address])
        subprocess.run(["ifconfig", interface, "up"])

        print(colored(f"\n[+] La MAC ha sido cambiada exitosamente",'green'))
    else:
        print(colored(f"\n[!] Los datos introducidos no son correctos",'red'))


def main():
    args = get_arguments()
    change_mac_address(args.interface, args.mac_address)

if __name__ == '__main__':
    main()
